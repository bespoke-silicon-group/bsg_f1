# Amazon FPGA Hardware Development Kit
#
# Copyright 2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.
#
# Licensed under the Amazon Software License (the "License"). You may not use
# this file except in compliance with the License. A copy of the License is
# located at
#
#    http://aws.amazon.com/asl/
#
# or in the "license" file accompanying this file. This file is distributed on
# an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or
# implied. See the License for the specific language governing permissions and
# limitations under the License.

##################################################################
## Makefile For Vivado compiles and simulations
##################################################################

compile: $(SIM_ROOT)
	mkdir -p $(SIM_ROOT)
	cd $(SIM_ROOT) && xsc $(C_FILES) --additional_option "-I$(C_SDK_USR_INC_DIR)" --additional_option "-I$(C_SDK_USR_UTILS_DIR)" --additional_option "-I$(C_COMMON_DIR)/include" --additional_option "-I$(C_COMMON_DIR)/src" --additional_option "-I$(C_INC_DIR)" --additional_option "-I$(CL_DIR)/libraries" --additional_option "-DVIVADO_SIM" --additional_option "-DSV_TEST" --additional_option "-DCOSIM=1" 
	cd $(SIM_ROOT) && xvlog --sv -m64 $(XVLOG_OPTS) --initfile $(XILINX_VIVADO)/data/xsim/ip/xsim_ip.ini --work xil_defaultlib --relax -f $(SCRIPTS_DIR)/../top.vivado.f $(SCRIPTS_DIR)/cosim_wrapper.sv
	cd $(SIM_ROOT) && xelab -m64 $(XELOG_OPTS) --initfile $(XILINX_VIVADO)/data/xsim/ip/xsim_ip.ini --timescale 1ps/1ps --debug typical --relax --mt 8 -L axis_register_slice_v1_1_17 -L fifo_generator_v13_2_2 -L axis_data_fifo_v1_1_18 -L axis_dwidth_converter_v1_1_16 -L axi_fifo_mm_s_v4_1_14 -L axi_clock_converter_v2_1_11 -L axis_infrastructure_v1_1_0 -L generic_baseblocks_v2_1_0 -L axi_infrastructure_v1_1_0 -L axi_register_slice_v2_1_15 -L axi_register_slice_v2_1_12 -L fifo_generator_v13_2_1 -L fifo_generator_v13_1_4 -L axi_data_fifo_v2_1_11 -L axi_crossbar_v2_1_13 -L xil_defaultlib -L unisims_ver -L unimacro_ver -L secureip -L xpm -sv_lib dpi --snapshot tb xil_defaultlib.tb xil_defaultlib.glbl xil_defaultlib.$(RTL_TB_MODULE) 

sim:
	cd $(SIM_ROOT) && xsim $(XSIM_OPTS) -R -log $(RTL_TB_MODULE).log tb
#	-tclbatch $(SCRIPTS_DIR)/waves.tcl tb

